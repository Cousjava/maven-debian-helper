#!/bin/sh

# This is an example script that allows running maven on the command
# line in a similar way as our cdbs snippets work. Copy this script to
# /usr/local/bin if you want to have it in the $PATH. Production use is
# not supported by the maintainer of maven-debian-helper.

DEB_CLASSPATH=/usr/share/java/classworlds.jar
JAVA_OPTS=-Dclassworlds.conf=/etc/maven2/m2-debian.conf
MAIN_CLASS=org.codehaus.classworlds.Launcher
MAVEN_OPTS=-s/etc/maven2/settings-debian.xml
MAVEN_REPO=/usr/share/maven-repo

AUTO_PROPS=$(mktemp)
find $MAVEN_REPO -name "*.pom" | \
  sed -e"s,^$MAVEN_REPO/,," \
      -e"s,/\([0-9][^/]*\).*,.version = \1," \
      -e"s,/,.,g"                            > $AUTO_PROPS
JAVA_OPTS="$JAVA_OPTS -Dproperties.file.auto=$AUTO_PROPS"
MAVEN_OPTS="$MAVEN_OPTS -Ddebian.dir=$PWD/debian"

if [ -r debian/control ]; then
  JAR_PACKAGE=$(dh_listpackages | awk '{ print $1 }')
  MAVEN_OPTS="$MAVEN_OPTS -Ddebian.package=$JAR_PACKAGE"
fi

java -noverify -cp $DEB_CLASSPATH $JAVA_OPTS $MAIN_CLASS "$@" $MAVEN_OPTS

rm $AUTO_PROPS

